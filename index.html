<!doctype html>
<html manifest="checktags.appcache">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Check ommited tags</title>
    <meta name="description" content="Online tool to check for ommited tags">
    <meta name="author" content="Marchenko Alexandr">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        h1, p {text-align:center}
        pre, code {color:#999}
        .label-warning, .label-warning .title {color:white!important;font-weight:bold!important;}

        .hljs{display:block;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-template_comment,.diff .hljs-header,.hljs-javadoc{color:#998;font-style:italic}.hljs-keyword,.css .rule .hljs-keyword,.hljs-winutils,.javascript .hljs-title,.nginx .hljs-title,.hljs-subst,.hljs-request,.hljs-status{color:#333;font-weight:bold}.hljs-number,.hljs-hexcolor,.ruby .hljs-constant{color:#099}.hljs-string,.hljs-tag .hljs-value,.hljs-phpdoc,.tex .hljs-formula{color:#d14}.hljs-title,.hljs-id,.coffeescript .hljs-params,.scss .hljs-preprocessor{color:#900;font-weight:bold}.javascript .hljs-title,.lisp .hljs-title,.clojure .hljs-title,.hljs-subst{font-weight:normal}.hljs-class .hljs-title,.haskell .hljs-type,.vhdl .hljs-literal,.tex .hljs-command{color:#458;font-weight:bold}.hljs-tag,.hljs-tag .hljs-title,.hljs-rules .hljs-property,.django .hljs-tag .hljs-keyword{color:#000080;font-weight:normal}.hljs-attribute,.hljs-variable,.lisp .hljs-body{color:#008080}.hljs-regexp{color:#009926}.hljs-symbol,.ruby .hljs-symbol .hljs-string,.lisp .hljs-keyword,.tex .hljs-special,.hljs-prompt{color:#990073}.hljs-built_in,.lisp .hljs-title,.clojure .hljs-built_in{color:#0086b3}.hljs-preprocessor,.hljs-pragma,.hljs-pi,.hljs-doctype,.hljs-shebang,.hljs-cdata{color:#999;font-weight:bold}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.diff .hljs-change{background:#0086b3}.hljs-chunk{color:#aaa}
    </style>
</head>
<body>
<div class="container" style="margin:1em auto">
    <h1>Check ommited tags</h1>
    <form>
        <p><textarea class="form-control" rows="20" type="text" id="html" title="Paste your html here..." placeholder="Paste your html here..." required></textarea></p>
        <p><button type="submit" class="btn btn-primary btn-block" disabled="disabled">Check</button></p>
        <p><a href="https://github.com/mac2000/checktags">Fork me on GitHub</a></p>
        <noscript><p class="alert alert-danger">Turn on javascript please<p></noscript>
    </form>
</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script>
    (function($){
        $('button').removeAttr('disabled');

        var $pre = $('<pre></pre>').hide().appendTo('.container');
        var $code = $('<code></code>').addClass('html').appendTo('pre:first');

        $('form').on('submit', function(e){
            e.preventDefault();

            var html = $.trim($('#html').val());

            html = check_closed_tags(html);
            colorize_and_report(html)

            return false;
        });

        function htmlspecialchars(string) {
            return jQuery('<span>').text(string).html();
        }

        function check_closed_tags(html) {
            //remove comments
            html = html.replace(/<!--[\s\S]*?-->/gi, '');
            //collapse scripts
            html = html.replace(/<script[\s\S]*?<\/script>/gi, '[script]');
            //collapse scripts
            html = html.replace(/<style[\s\S]*?<\/style>/gi, '[style]');
            //collapse self closed tags
            html = html.replace(/<(\w+[^>]*\/)>/gi, '[$1]');

            //collapse safe self closed tags
            html = html.replace(new RegExp('<(img[^>]*)>', 'gi'), '[$1]');
            html = html.replace(new RegExp('<(br[^>]*)>', 'gi'), '[$1]');
            html = html.replace(new RegExp('<(hr[^>]*)>', 'gi'), '[$1]');
            html = html.replace(new RegExp('<(input[^>]*)>', 'gi'), '[$1]');
            html = html.replace(new RegExp('<(button[^>]*)>', 'gi'), '[$1]');
            html = html.replace(new RegExp('<(meta[^>]*)>', 'gi'), '[$1]');
            html = html.replace(new RegExp('<(link[^>]*)>', 'gi'), '[$1]');

            //remove strange tags like our links generated by asp.net
            html = html.replace(new RegExp('<\/link>', 'gi'), '');

            //collapse tags without nested tags
            while(html.match(/<(\w+)[^>]*>(?:(?!\$\{)[^<])*<\/\1>/gi)) {
                html = html.replace(/<(\w+)([^>]*)>(?:(?!\$\{)[^<])*<\/\1>/gi, '[$1$2]...[$1]');
            }

            return html;
        }

        function colorize_and_report(html) {
            $pre.show();
            $code.html(htmlspecialchars(html));
            hljs.highlightBlock($code.get(0));
            add_class_names();
        }

        function add_class_names() {
            $('.hljs-tag:contains("</")', $code).addClass('close_tag');
            $('.hljs-tag[class="hljs-tag"]', $code).addClass('open_tag');

            $('.hljs-tag', $code).each(function(index, item){
                $(item).addClass($(item).find('.title').text()+'_tag');
            });

            $('.hljs-tag', $code).each(function(index, item){
                var tag = $(item).find('.title').text();
                var open = $('span.hljs-tag.open_tag.' + tag + '_tag').size();
                var close = $('span.hljs-tag.close_tag.' + tag + '_tag').size();
                if(open != close) $(item).addClass('label').addClass('label-warning');
            });
        }
    })(jQuery);
</script>
</body>
</html>
